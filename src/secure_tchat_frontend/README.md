# TChat Backend Developer Guide

## Overview

This document provides backend developers with the necessary information to implement and integrate the backend services for the TChat application. TChat is a modern chat platform supporting real-time messaging, media attachments, and advanced features like message replies.

---

## Table of Contents

- [Core Features](#core-features)
- [API Endpoints](#api-endpoints)
- [Data Models](#data-models)
- [Authentication](#authentication)
- [Media Handling](#media-handling)
- [Reply Functionality](#reply-functionality)
- [Error Handling](#error-handling)
- [Integration Notes](#integration-notes)
- [Future Enhancements](#future-enhancements)

---

## Core Features

- **User Authentication** (sign up, login, logout)
- **One-on-One & Group Chats**
- **Message Sending** (text, media attachments)
- **Reply to Message**
- **Message Read/Unread Tracking**
- **Media Viewer Support**
- **Dark/Light Mode Preferences** (stored per user)
- **Typing Indicators, Reactions, etc.** (planned)

---

## API Endpoints

Here are the expected RESTful endpoints (suggested structure):

### Authentication

- `POST /api/auth/register`
- `POST /api/auth/login`
- `POST /api/auth/logout`
- `GET /api/auth/me`

### Users & Contacts

- `GET /api/users/:id`
- `GET /api/users`
- `GET /api/contacts` (for current user)

### Chats

- `GET /api/chats` (list all chats for user)
- `POST /api/chats` (create new chat)
- `GET /api/chats/:chatId`
- `DELETE /api/chats/:chatId`

### Messages

- `GET /api/chats/:chatId/messages`
- `POST /api/chats/:chatId/messages`
- `GET /api/chats/:chatId/messages/:messageId`
- `DELETE /api/chats/:chatId/messages/:messageId`

### Media

- `POST /api/media/upload`
- `GET /api/media/:mediaId`

---

## Data Models

### User

```json
{
  "id": "string",
  "displayName": "string",
  "photoURL": "string",
  "email": "string",
  "lastSeen": "ISO8601 string",
  "darkMode": true
}
```

### Chat

```json
{
  "id": "string",
  "participants": ["userId1", "userId2"],
  "messages": ["messageId1", "messageId2"],
  "lastMessage": { ... },
  "unreadCount": 0
}
```

### Message

```json
{
  "id": "string",
  "chatId": "string",
  "senderId": "string",
  "timestamp": "ISO8601 string",
  "text": "string",
  "attachments": [
    {
      "id": "string",
      "name": "string",
      "type": "string",
      "size": 12345,
      "url": "string"
    }
  ],
  "replyTo": {
    "id": "string",
    "senderName": "string",
    "text": "string"
  }
}
```

---

## Authentication

- Use JWT or session-based authentication.
- Protect all chat/message endpoints.
- Provide user info on `/api/auth/me` for frontend state.

---

## Media Handling

- Support image, video, audio, and document uploads.
- Store media securely and return accessible URLs.
- Enforce size/type limits and scan for viruses.

---

## Reply Functionality

- Each message may have an optional `replyTo` field referencing another message.
- When replying, include the original messageâ€™s ID, sender, and a preview of the text.

---

## Error Handling

- Return clear error messages and HTTP status codes.
- Example: `{ "error": "Message not found" }`

---

## Integration Notes

- The frontend expects JSON responses.
- All timestamps should be ISO8601 strings (UTC).
- Ensure CORS is enabled for frontend development.
- Support pagination for message fetching.
- Consider WebSocket or SSE for real-time updates.

---

## Future Enhancements

- Message reactions
- Typing indicators
- Read receipts
- Push notifications

---

## Contact

For questions, contact the frontend team or refer to the `/src/secure_tchat_frontend/` directory for integration examples.

### Note on frontend environment variables

If you are hosting frontend code somewhere without using DFX, you may need to make one of the following adjustments to ensure your project does not fetch the root key in production:

- set`DFX_NETWORK` to `ic` if you are using Webpack
- use your own preferred method to replace `process.env.DFX_NETWORK` in the autogenerated declarations
  - Setting `canisters -> {asset_canister_id} -> declarations -> env_override to a string` in `dfx.json` will replace `process.env.DFX_NETWORK` with the string in the autogenerated declarations
- Write your own `createActor` constructor  